<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
        <title>캡스톤디자인</title>
        <link rel="stylesheet" href="/stylesheets/style.css">
        <!-- 네이버맵API -->
        <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=et2z2loo9f"></script>
        <!-- 카카오API -->
        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b9dd4f47d571d9edfb05706b9a5b3ec2&libraries=services"></script>
        <!-- Jquery CDN 코드 -->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    </head>

    <body>
        <div id="navbar">주변관광지 찾기</div>
        <div id="search">
            <input id="search_input" placeholder="목적지를 입력해주세요">
            <button id="search_button">검색</button>
        </div>
        <div id="current">현재위치</div>
        <div id="map" style="width:100%;height:100vh;"></div>
        <script>
            //-------------------------------지도 띄우기-------------------------
            var mapOptions = {
                center: new naver.maps.LatLng(37.3595704, 127.105399),
                zoom: 7
            };
            var map = new naver.maps.Map("map", mapOptions);
            // ----------------------------------현재위치------------------------------------
            
            $('#current').click(()=> {
                if('geolocation' in navigator) {
                    navigator.geolocation.getCurrentPosition( function(position) {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        const latlng = new naver.maps.LatLng(lat, lng);
                        marker = new naver.maps.Marker({
                            map: map,
                            position: latlng,
                            icon: {
                                content: '<img class="pulse" draggable="false" unselectable="on" src="https://myfirstmap.s3.ap-northeast-2.amazonaws.com/circle.png" >',
                                anchor: new naver.maps.Point(11,11)
                            }
                        });
                        map.setZoom(14, false);
                        map.panTo(latlng);
                        $.ajax({
                            method: "GET",
                            url: `http://api.visitkorea.or.kr/openapi/service/rest/KorService/locationBasedList?ServiceKey=OfJRD4FTDToxwYcjmf7xMNJ6v07sE3IhZxn2xGB0t1tLMrHv%2FP8mbPcCln409zA3kTQB7KZ84TsbStxaa%2B6KuA%3D%3D&contentTypeId=12&mapX=${lng}&mapY=${lat}&radius=20000&listYN=Y&MobileOS=ETC&MobileApp=TourAPI3.0_Guide&arrange=A&numOfRows=12&pageNo=1`
                        })
                        .done(function( msg ) {
                            console.log(msg);
                        });
                    });
                } else {
                    alert("위치정보 사용 불가능");
                }
            });
        </script>
    </body>
</html>